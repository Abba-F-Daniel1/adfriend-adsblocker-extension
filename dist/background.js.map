{"version":3,"file":"background.js","sources":["../src/background/background.ts"],"sourcesContent":["// Initialize storage and rules\nchrome.runtime.onInstalled.addListener(async () => {\n  console.log(\"[AdFriend] Extension installed/updated\");\n\n  // Initialize chrome.storage\n  await chrome.storage.sync.set({\n    blockedCount: 0,\n    enabled: true,\n  });\n\n  console.log(\"[AdFriend] Storage initialized\");\n\n  // Set extension action options\n  await chrome.declarativeNetRequest.setExtensionActionOptions({\n    displayActionCountAsBadgeText: true,\n  });\n});\n\n// Function to update rules based on enabled state\nasync function updateRules(enabled: boolean) {\n  try {\n    if (enabled) {\n      // Enable blocking rules\n      await chrome.declarativeNetRequest.updateEnabledRulesets({\n        enableRulesetIds: [\"ruleset_1\"],\n      });\n      console.log(\"[AdFriend] Blocking rules enabled\");\n    } else {\n      // Disable blocking rules\n      await chrome.declarativeNetRequest.updateEnabledRulesets({\n        disableRulesetIds: [\"ruleset_1\"],\n      });\n      // Notify all tabs to remove inspirational content\n      const tabs = await chrome.tabs.query({});\n      tabs.forEach((tab) => {\n        if (tab.id) {\n          chrome.tabs.sendMessage(tab.id, { type: \"DISABLE_ADFRIEND\" });\n        }\n      });\n      console.log(\"[AdFriend] Blocking rules disabled\");\n    }\n  } catch (error) {\n    console.error(\"[AdFriend] Error updating rules:\", error);\n  }\n}\n\n// Listen for storage changes to handle enable/disable\nchrome.storage.onChanged.addListener((changes, namespace) => {\n  if (namespace === \"sync\" && changes.enabled) {\n    const isEnabled = changes.enabled.newValue;\n    updateRules(isEnabled);\n\n    if (!isEnabled) {\n      chrome.action.setBadgeText({ text: \"\" });\n    } else {\n      chrome.storage.sync.get([\"blockedCount\"], (result) => {\n        const count = result.blockedCount || 0;\n        chrome.action.setBadgeText({ text: count.toString() });\n      });\n    }\n  }\n});\n\n// Listen for rule matches only when enabled\nchrome.declarativeNetRequest.onRuleMatchedDebug?.addListener(\n  async ({ request }) => {\n    const { enabled } = await chrome.storage.sync.get(\"enabled\");\n    if (!enabled) return;\n\n    if (request.type === \"main_frame\") return;\n\n    chrome.storage.sync.get([\"blockedCount\"], (result) => {\n      const newBlockedCount = (result.blockedCount || 0) + 1;\n      chrome.storage.sync.set({ blockedCount: newBlockedCount });\n      chrome.action.setBadgeText({ text: newBlockedCount.toString() });\n    });\n  }\n);\n\n// Listen for startup\nchrome.runtime.onStartup.addListener(async () => {\n  const { enabled } = await chrome.storage.sync.get(\"enabled\");\n  updateRules(enabled);\n\n  if (enabled) {\n    const { blockedCount = 0 } = await chrome.storage.sync.get(\"blockedCount\");\n    chrome.action.setBadgeText({ text: blockedCount.toString() });\n  }\n});\n"],"names":["updateRules","enabled","tab","error","changes","namespace","isEnabled","result","count","_a","request","newBlockedCount","blockedCount"],"mappings":"AACA,OAAO,QAAQ,YAAY,YAAY,SAAY,CACjD,QAAQ,IAAI,wCAAwC,EAG9C,MAAA,OAAO,QAAQ,KAAK,IAAI,CAC5B,aAAc,EACd,QAAS,EAAA,CACV,EAED,QAAQ,IAAI,gCAAgC,EAGtC,MAAA,OAAO,sBAAsB,0BAA0B,CAC3D,8BAA+B,EAAA,CAChC,CACH,CAAC,EAGD,eAAeA,EAAYC,EAAkB,CACvC,GAAA,CACEA,GAEI,MAAA,OAAO,sBAAsB,sBAAsB,CACvD,iBAAkB,CAAC,WAAW,CAAA,CAC/B,EACD,QAAQ,IAAI,mCAAmC,IAGzC,MAAA,OAAO,sBAAsB,sBAAsB,CACvD,kBAAmB,CAAC,WAAW,CAAA,CAChC,GAEY,MAAM,OAAO,KAAK,MAAM,CAAE,CAAA,GAClC,QAASC,GAAQ,CAChBA,EAAI,IACN,OAAO,KAAK,YAAYA,EAAI,GAAI,CAAE,KAAM,mBAAoB,CAC9D,CACD,EACD,QAAQ,IAAI,oCAAoC,SAE3CC,EAAO,CACN,QAAA,MAAM,mCAAoCA,CAAK,CACzD,CACF,CAGA,OAAO,QAAQ,UAAU,YAAY,CAACC,EAASC,IAAc,CACvD,GAAAA,IAAc,QAAUD,EAAQ,QAAS,CACrC,MAAAE,EAAYF,EAAQ,QAAQ,SAClCJ,EAAYM,CAAS,EAEhBA,EAGH,OAAO,QAAQ,KAAK,IAAI,CAAC,cAAc,EAAIC,GAAW,CAC9C,MAAAC,EAAQD,EAAO,cAAgB,EACrC,OAAO,OAAO,aAAa,CAAE,KAAMC,EAAM,WAAY,CAAA,CACtD,EALD,OAAO,OAAO,aAAa,CAAE,KAAM,EAAI,CAAA,CAO3C,CACF,CAAC,EA5DD,IAAAC,GA+DAA,EAAA,OAAO,sBAAsB,qBAA7B,MAAAA,EAAiD,YAC/C,MAAO,CAAE,QAAAC,CAAA,IAAc,CACf,KAAA,CAAE,QAAAT,CAAY,EAAA,MAAM,OAAO,QAAQ,KAAK,IAAI,SAAS,EACtDA,GAEDS,EAAQ,OAAS,cAErB,OAAO,QAAQ,KAAK,IAAI,CAAC,cAAc,EAAIH,GAAW,CAC9C,MAAAI,GAAmBJ,EAAO,cAAgB,GAAK,EACrD,OAAO,QAAQ,KAAK,IAAI,CAAE,aAAcI,EAAiB,EACzD,OAAO,OAAO,aAAa,CAAE,KAAMA,EAAgB,WAAY,CAAA,CAChE,CACH,GAIF,OAAO,QAAQ,UAAU,YAAY,SAAY,CACzC,KAAA,CAAE,QAAAV,CAAY,EAAA,MAAM,OAAO,QAAQ,KAAK,IAAI,SAAS,EAG3D,GAFAD,EAAYC,CAAO,EAEfA,EAAS,CACL,KAAA,CAAE,aAAAW,EAAe,CAAE,EAAI,MAAM,OAAO,QAAQ,KAAK,IAAI,cAAc,EACzE,OAAO,OAAO,aAAa,CAAE,KAAMA,EAAa,WAAY,CAC9D,CACF,CAAC"}